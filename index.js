const kapitelVier = [
    [
        {"ger": "das Dachgeschoss", "pol": "poddasze"},
        {"ger": "der Empfang", "pol": "tu: zasieg"},
        {"ger": "das Gartenhaus", "pol": "donnek ogrodowy"},
        {"ger": "der Internetanschluss", "pol": "łącze internetowe"},
        {"ger": "der Keller", "pol": "piwnica"},
        {"ger": "die Küchenmöbel", "pol": "meble kuchenne"},
        {"ger": "die Möbel", "pol": "meble"},
        {"ger": "die Traumwohnung", "pol": "wymorzone mieszkanie"},
        {"ger": "einrichten", "pol": "urządzać"},
        {"ger": "gehören", "pol": "należeć"},
        {"ger": "streichen", "pol": "malować (ściany)"},
        {"ger": "überzeugen", "pol": "przekonywać"},
        {"ger": "um|bauen", "pol": "przebudowywać"},
        {"ger": "ziehen", "pol": "tu: przeprowadzać się"},
        {"ger": "dunkel", "pol": "ciemny"},
        {"ger": "eigen", "pol": "własny"},
        {"ger": "fehlend", "pol": "brakujący"},
        {"ger": "feucht", "pol": "wilgotny"},
        {"ger": "gemütlich", "pol": "przytulny"},
        {"ger": "hell", "pol": "jasny"},
        {"ger": "ungewöhnlich", "pol": "niezwykły, nietypowy"},
        {"ger": "das Zimmer ein|richten", "pol": "urządzać pokój"},
        {"ger": "in den Keller ziehen", "pol": "wprowadzać się do piwnicy"},
        {"ger": "Ja sagen", "pol": "powiedzieć tak, zgadzać się"},
        {"ger": "alles in Weiß streichen", "pol": "pomalować wszystko na biało"},
        {"ger": "keinen Empfang haben", "pol": "nie mieć zasięgu"}
    ],
    [
        {"ger": "der Fisch", "pol": "ryba"},
        {"ger": "der Frosch", "pol": "żaba"},
        {"ger": "der Gecko", "pol": "gekon"},
        {"ger": "der Hamster", "pol": "chomik"},
        {"ger": "der Kanarienvogel", "pol": "kanarek"},
        {"ger": "das Kaninchen", "pol": "królik"},
        {"ger": "die Maus", "pol": "mysz"},
        {"ger": "das Meerschweinchen", "pol": "świnka morska"},
        {"ger": "der Papagei", "pol": "papuga"},
        {"ger": "die Ratte", "pol": "szczur"},
        {"ger": "die Schildkröte", "pol": "żółw"},
        {"ger": "die Schlange", "pol": "wąż"},
        {"ger": "die Pflicht", "pol": "obowiązek"},
        {"ger": "auf|passen", "pol": "uważać"},
        {"ger": "beißen", "pol": "gryźć"},
        {"ger": "füttern", "pol": "karmić (zwierzęta)"},
        {"ger": "sich kümmern", "pol": "troszczyć się"},
        {"ger": "streicheln", "pol": "głaskać"},
        {"ger": "zerkratzen", "pol": "drapać"},
        {"ger": "Gassi gehen", "pol": "iść na spacer"},
        {"ger": "Pflege brauchen", "pol": "potrzebować opieki"},
        {"ger": "schmutzig machen", "pol": "brudzić"},
        {"ger": "in alle Schuhe beißen", "pol": "gryźć wszystkie buty"},
        {"ger": "auf das Terrarium springen", "pol": "skakać na terrarium"},
        {"ger": "vom Tisch klauen", "pol": "kraść ze stołu"}
    ],
    [
        {"ger": "der Fußboden", "pol": "podłoga"},
        {"ger": "das Fenster", "pol": "okno"},
        {"ger": "die Schublade", "pol": "szuflada"},
        {"ger": "der Teppich", "pol": "dywan"},
        {"ger": "die Tür", "pol": "drzwi"},
        {"ger": "die Wand", "pol": "ściana"},
        {"ger": "ab|hängen", "pol": "zależeć"},
        {"ger": "ändern", "pol": "zmieniać"},
        {"ger": "hängen", "pol": "wieszać"},
        {"ger": "liegen / legen", "pol": "leżeć / kłaść"},
        {"ger": "stecken", "pol": "wkładać"},
        {"ger": "stehen / stellen", "pol": "stać / stawiać"},
        {"ger": "um|räumen", "pol": "przestawiać"},
        {"ger": "um|stellen", "pol": "przestawiać"},
        {"ger": "hinter", "pol": "za"},
        {"ger": "neben", "pol": "obok"},
        {"ger": "über", "pol": "nad"},
        {"ger": "unter", "pol": "pod"},
        {"ger": "zwischen", "pol": "między"},
        {"ger": "das Zimmer um|räumen", "pol": "przemeblowywać pokój"},
        {"ger": "alles ändern", "pol": "zmieniać wszystko"},
        {"ger": "Alles sieht neu aus.", "pol": "Wszystko wygląda na nowe."}
    ],
    [
        {"ger": "der Bauernhof", "pol": "gospodarstwo rolne"},
        {"ger": "die Einkaufsmöglichkeit", "pol": "możliwość robienia zakupów"},
        {"ger": "die Gegend", "pol": "okolica"},
        {"ger": "die Kuh", "pol": "krowa"},
        {"ger": "das Pferd", "pol": "koń"},
        {"ger": "das Pony", "pol": "kucyk"},
        {"ger": "das Schwein", "pol": "świnia"},
        {"ger": "die Ziege", "pol": "koza"},
        {"ger": "die Verkehrsverbindung", "pol": "połączenie komunikacyjne"},
        {"ger": "ernten", "pol": "zbierać plony"},
        {"ger": "halten", "pol": "tu: hodować"},
        {"ger": "vermissen", "pol": "tęsknić, odczuwać brak"},
        {"ger": "unter der Woche", "pol": "w tygodniu"},
        {"ger": "weit voneinander entfernt", "pol": "daleko od siebie oddalone"},
        {"ger": "sich im Dorf wohl fühlen", "pol": "czuć się dobrze na wsi"},
        {"ger": "einen guten Kontakt haben", "pol": "mieć dobry kontakt"},
        {"ger": "Tiere pflegen", "pol": "dbać o zwierzęta"},
        {"ger": "viele Vorteile sehen", "pol": "widzieć wiele zalet"},
        {"ger": "Es gibt ein paar Nachteile.", "pol": "Jest parę wad."}
    ]
];

const kapitelVierZdania = [
    [
        {"ger": "Wie findest du das alte Gartenhaus?", "pol": "Co sądzisz o starym domku ogrodowym?"},
        {"ger": "Es gefällt mir sehr.", "pol": "Bardzo mi się podoba."},
        {"ger": "Wie ist die neue Wohnung von Martin?", "pol": "Jakie jest nowe mieszkanie Martina?"},
        {"ger": "Ganz schön groß.", "pol": "Całkiem duże."},
        {"ger": "Max, hast du neue Möbel gekauft?", "pol": "Max, czy kupiłeś nowe meble?"},
        {"ger": "Ja, den großen Schreibtisch hier.", "pol": "Tak, duże biurko tutaj."},
        {"ger": "Musstest du dein Zimmer renovieren?", "pol": "Czy musiałeś odnowić swój pokój?"},
        {"ger": "Ja, ich habe die Wände weiß gestrichen.", "pol": "Tak, pomalowałem ściany na biało."}
    ],
    [
        {"ger": "Wo steht in deinem Zimmer das Bett?", "pol": "Gdzie w twoim pokoju stoi łóżko?"},
        {"ger": "Unter dem Fenster.", "pol": "Pod oknem."},
        {"ger": "Was hängt bei dir an den Wänden?", "pol": "Co wisi u ciebie na ścianach?"},
        {"ger": "Sehr viele Poster.", "pol": "Bardzo dużo plakatów."},
        {"ger": "Wohin legst du deine Schulsachen?", "pol": "Gdzie kładziesz swoje rzeczy szkolne?"},
        {"ger": "Ich lege sie auf den Schreibtisch.", "pol": "Kładę je na biurku."},
        {"ger": "Wohin kommt das neue Regal?", "pol": "Gdzie postawisz nowy regał?"},
        {"ger": "Zwischen die Kommode und den Schreibtisch.", "pol": "Między komodą a biurkiem."}
    ],
    [
        {"ger": "Hast du zu Hause Haustiere?", "pol": "Czy masz zwierzęta w domu?"},
        {"ger": "Ja, deshalb habe ich viele Pflichten.", "pol": "Tak, dlatego mam wiele obowiązków."},
        {"ger": "Gehst du dreimal täglich mit dem Hund Gassi?", "pol": "Czy spacerujesz trzy razy dziennie z psem?"},
        {"ger": "Ja. Trotzdem macht mir das viel Spaß.", "pol": "Tak. Mimo to sprawia mi to wiele przyjemności."},
        {"ger": "Katzen zu Hause? Gibt es Probleme?", "pol": "Koty w domu? Czy jest to kłopotliwe?"},
        {"ger": "Ja, die Katzen kratzen oft an den Möbeln.", "pol": "Tak, koty drapią często meble."},
        {"ger": "Willst du Haustiere haben?", "pol": "Czy chcesz mieć zwierzęta?"},
        {"ger": "Ja, ein Terrarium mit Schildkröten.", "pol": "Tak, terrarium z żółwiami."}
    ],
    [
        {"ger": "Ist es gut, auf dem Land zu wohnen?", "pol": "Czy dobrze jest mieszkać na wsi?"},
        {"ger": "Ja, ich mag das langsame Leben hier.", "pol": "Tak, lubię powolne życie tutaj."},
        {"ger": "Gefällt es dir, in der Stadt zu leben?", "pol": "Czy podoba ci się życie w mieście?"},
        {"ger": "Ja, ich sehe nur Vorteile.", "pol": "Tak, widzę tylko zalety."},
        {"ger": "Du lebst auf dem Land. Gibt es Nachteile?", "pol": "Mieszkasz na wsi. Czy są wady?"},
        {"ger": "Ja, zum Kino sind es fast 35 Kilometer!", "pol": "Tak, do kina jest prawie 35 km!"},
        {"ger": "Hast du vor, mal in einer Großstadt zu wohnen?", "pol": "Czy zamierzasz mieszkać w dużym mieście?"},
        {"ger": "Ich frage mich das auch. Mal sehen.", "pol": "Zadaję sobie to pytanie. Zobaczymy."}
    ]
];

const porzadkowe = [
    {"ger": "erste", "pol": "pierwszy"},
    {"ger": "zweite", "pol": "drugi"},
    {"ger": "dritte", "pol": "trzeci"},
    {"ger": "vierte", "pol": "czwarty"},
    {"ger": "fünfte", "pol": "piąty"},
    {"ger": "sechste", "pol": "szósty"},
    {"ger": "siebte", "pol": "siódmy"},
    {"ger": "achte", "pol": "ósmy"},
    {"ger": "neunte", "pol": "dziewiąty"},
    {"ger": "zehnte", "pol": "dziesiąty"},
    {"ger": "elfte", "pol": "jedenasty"},
    {"ger": "zwölfte", "pol": "dwunasty"},
    {"ger": "dreizehnte", "pol": "trzynasty"},
    {"ger": "vierzehnte", "pol": "czternasty"},
    {"ger": "fünfzehnte", "pol": "piętnasty"},
    {"ger": "sechzehnte", "pol": "szesnasty"},
    {"ger": "siebzehnte", "pol": "siedemnasty"},
    {"ger": "achtzehnte", "pol": "osiemnasty"},
    {"ger": "neunzehnte", "pol": "dziewiętnasty"},
    {"ger": "zwanzigste", "pol": "dwudziesty"}
]

let preferences = [false, false, false];
let availableWords = create_word_array(true, true, true);
let answer;

const appDiv = document.getElementById("app");
const resultDiv = document.getElementById("result");

const lastInputSpan = document.getElementById("last-input");
const expectedSpan = document.getElementById("output");
const toTranslateSpan = document.getElementById("to-translate");

const input = document.getElementById("input");
const submitBtn = document.getElementById("submit");
const okBtn = document.getElementById("ok");

const opcje = document.getElementById("opcje");
const optionsok = document.getElementById("optionsok");
const optionsDiv = document.getElementById("options");
const ansDiv = document.getElementById("ans");

let mode = 0;

function create_word_array() {
    let array = [];
    if (preferences[0][0]) array = array.concat(kapitelVier[0]);
    if (preferences[0][1]) array = array.concat(kapitelVier[1]);
    if (preferences[0][2]) array = array.concat(kapitelVier[2]);
    if (preferences[0][3]) array = array.concat(kapitelVier[3]);
    if (preferences[1][0]) array = array.concat(kapitelVierZdania[0]);
    if (preferences[1][1]) array = array.concat(kapitelVierZdania[1]);
    if (preferences[1][2]) array = array.concat(kapitelVierZdania[2]);
    if (preferences[1][3]) array = array.concat(kapitelVierZdania[3]);
    if (preferences[2]) array = array.concat(porzadkowe);
    return array;
}

function apply_settings() {
    let ok = document.querySelectorAll(".option input:checked");
    preferences[0] = Array();
    preferences[1] = Array();
    preferences[2] = false;
    ok.forEach(e => {
        switch (e.id) {
            case "gerpol":
                mode = 0;
                break;
            case "polger":
                mode = 1;
                break;
            case "random":
                mode = 2;
                break;
            case "k4t1":
                preferences[0][0] = true;
                break;
            case "k4t2":
                preferences[0][1] = true;
                break;
            case "k4t3":
                preferences[0][2] = true;
                break;
            case "k4t4":
                preferences[0][3] = true;
                break;
            case "kzwei1":
                preferences[1][0] = true;
                break;
            case "kzwei2":
                preferences[1][1] = true;
                break;
            case "kzwei3":
                preferences[1][2] = true;
                break;
            case "kzwei4":
                preferences[1][3] = true;
                break;
            case "prateritum":
                preferences[2] = true;
                break;
            default:
                break;
        }
    });
    availableWords = create_word_array();
}

{
    let opts = JSON.parse(localStorage.getItem("options"));
    if (opts !== undefined && opts !== null) {
        for (let i = 0; i < opts.length; i++) {
            try {
                let e = document.getElementById(opts[i][0]);
                e.checked = opts[i][1];
            } catch {
                localStorage.clear();
                window.location.reload();
            }
        }
    }
    apply_settings();
}

function rng(min, max) {
    return Math.floor(Math.random() * (max - min) + min);
}

function draw_word() {
    let randomIndex = rng(0, availableWords.length);
    let word = availableWords[randomIndex];
    availableWords.splice(randomIndex, 1);
    let t = word.ger;
    let a = word.pol;
    if (word.pra) {
        t = `${t} => ${word.pra}`;
    }
    let ok = mode;
    if (ok === 2) {
        ok = rng(0, 2);
    }
    if (ok) {
        return [a, t];
    } else {
        return [t, a];
    }
}

function submit() {
    if (answer === undefined) {
        answer = draw_word();
        toTranslateSpan.textContent = answer[0];
        return;
    }
    lastInputSpan.textContent = input.value;
    ansDiv.textContent = answer[0];
    expectedSpan.textContent = answer[1];
    appDiv.classList.add("hidden");
    resultDiv.classList.remove("hidden");
}

submitBtn.addEventListener("click", submit);

function new_word() {
    answer = draw_word();
    toTranslateSpan.textContent = answer[0];
    if (availableWords.length === 0)
        availableWords = create_word_array(preferences[0], preferences[1], preferences[2]);
    input.value = "";
    appDiv.classList.remove("hidden");
    resultDiv.classList.add("hidden");
    input.focus();
}

okBtn.addEventListener("click", new_word);

opcje.addEventListener("click", function() {
     optionsDiv.classList.remove("hidden");
});

optionsok.addEventListener("click", function() {
    optionsDiv.classList.add("hidden");
    let real = document.querySelectorAll(".option input");
    let s = [];
    real.forEach(e => {
         s.push([e.id, e.checked]);
    });
    localStorage.setItem("options", JSON.stringify(s));
    apply_settings();
    answer = undefined;
    toTranslateSpan.textContent = "Kliknij przycisk aby wylosowac ok?";
});

/*
const tenadole = document.getElementById("te-na-dole");
document.querySelector("#tenadole").addEventListener("click", () => {
    tenadole.classList.toggle("hidden");
});
*/

document.getElementById("clear").addEventListener("click", function() {
    localStorage.clear();
    window.location.reload();
});

document.addEventListener("keypress", e => {
    if (e.key === "Enter") {
        if (document.activeElement === input && !appDiv.classList.contains("hidden")) {
            submit();
        } else if (appDiv.classList.contains("hidden")) {
            new_word();
        }
    }
});